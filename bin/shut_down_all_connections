#!/usr/bin/env ruby
# frozen_string_literal: true

require 'bundler/setup'
require 'pg_eventstore'

PgEventstore.connection.with do |conn|
  conn.exec(<<~SQL)
    SELECT pg_terminate_backend(pg_stat_activity.pid)
    FROM pg_stat_activity
    WHERE pg_stat_activity.datname = 'eventstore' OR pg_stat_activity.datname = 'eventstore_test'
      AND pid <> pg_backend_pid();
  SQL
end
